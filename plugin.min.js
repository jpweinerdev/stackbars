/*!
 * stackbars.js 1.0.0
 * https://github.com/jpweinerdev/stackbars.js
 *
 * @license MIT (https://github.com/jpweinerdev/stackbars.js/blob/master/LICENSE)
 *
 * @copyright 2021 http://developer.jpweiner.net/stackbars.html - A project by Jean-Pierre Weiner - Developer
 */
(function(a,b,c,e){"use strict";function d(b,c){var d=this;this.element=b,this.settings=a.extend({},f,c),this._defaults=f,this._name="stackbars",this.update=function(a){d.settings.data=a,d.drawAndUpdate()},this.init()}var f={height:48,bottomMargin:0,container:"#indicator",colorSetting:["#33876b","#559559","#77a347","#98b236","#bac024","#dcce12","#cccccc","#b2b2b2","#9a9a9a","#808080","#4a4a4a","#121212"],stackMargin:0,stackHeight:6,textPositionEven:-4,textPositionOdd:-4,hoverButtonWidth:200,stackMinWidth:15,disableEvents:!1};a.extend(d.prototype,{getPercentatage:function(a,b){return Math.round(100*a/b)+"%"},svg:{},g:{},graphWidth:800,graphheight:28,bottomPosition:0,color:{},total:0,setBounds:function(){var a=e.select(this.settings.container).node().getBoundingClientRect();this.graphWidth=a.width,this.graphheight=this.settings.height,this.bottomPosition=this.settings.height-this.settings.stackHeight-this.settings.bottomMargin},initOnWindowResize:function(){var c=this;a(b).resize(function(){0!=c.settings.data.length&&(c.setBounds(),c.svg.attr("width",c.graphWidth),c.drawAndUpdate())})},init:function(){this;this.setBounds(),this.color=e.scaleOrdinal(this.settings.colorSetting),this.svg=e.select(this.settings.container).append("svg").attr("width",this.graphWidth).attr("height",this.graphheight),this.g=this.svg.append("g").attr("transform","translate(0,"+this.bottomPosition+")"),this.drawAndUpdate(),this.initOnWindowResize()},drawAndUpdate:function(){var a,b,d,f,g,h,j=this,k=0,l=e.transition().duration(750),i=this.settings.data,m=function(b){var c,d=e.select(this),f=j.g.selectAll("text"),g=j.graphWidth,h=a(b.base);e.event.preventDefault(),e.event.stopPropagation(),h+j.settings.hoverButtonWidth>g&&(h=g-j.settings.hoverButtonWidth),f.transition().duration(500).attr("opacity",0),d.select("text").attr("opacity",0).attr("text-anchor","start").text(q).transition().duration(500).attr("opacity",1).attr("dx",0),d.transition().duration(500).attr("transform",function(){return"translate("+h+","+-2*j.settings.stackHeight+")"}),c=d.select("rect").transition().duration(500).attr("width",function(b){return a(b.value)>j.settings.hoverButtonWidth?a(b.value):j.settings.hoverButtonWidth}).attr("height",3*j.settings.stackHeight)},o=function(c,d,f){var g,h=e.select(f[d]),i=j.g.selectAll("text");h.transition().duration(500).attr("transform",function(b){return"translate("+a(b.base)+",0)"}),g=h.select("rect").transition().duration(500).attr("width",function(a){return b(a)}).attr("height",j.settings.stackHeight),i.attr("opacity",0).attr("text-anchor","end"),h.select("text").text(r),i.transition().duration(500).attr("dx",function(b){return a(b.value)}).attr("opacity",1)},p=function(a){var b={key:a.key,label:a.label,value:a.value,percent:j.getPercentatage(a.value,k),total:k};j.onSectionClick(b)},q=function(a){var b={key:a.key,label:a.label,value:a.value,percent:j.getPercentatage(a.value,k),total:k};return j.hoverText(b)},r=function(a){return b(a)<j.settings.stackMinWidth?"":j.getPercentatage(a.value,k)};this.setBounds(),this.svg.attr("width",this.graphWidth),i=i.sort(function(c,a){return e.descending(c.value,a.value)}),i.forEach(function(a,b){a.key=b,a.base=k,k+=a.value}),a=e.scaleLinear().domain([0,e.sum(i,function(a){return a.value})]).range([0,j.graphWidth]),b=function(b){var c=a(b.value)-j.settings.stackMargin;return 0>c?0:c},d=this.g.selectAll(".stack").data(i,function(a){return a.key}),d.transition(l).attr("transform",function(b){return"translate("+a(b.base)+",0)"}).on("end",function(){var a=j.g.selectAll("text");a.transition().duration(500).attr("opacity",1)}),f=d.select("rect"),f.transition(l).attr("width",function(a){return b(a)}),g=d.select("text"),g.attr("opacity",0).transition(l).attr("dx",function(b){return a(b.value)}).attr("opacity",0).text(r),h=d.enter().append("g").attr("class","stack").attr("opacity",0).attr("transform","translate(0,0)"),h.transition(l).attr("opacity",1).attr("transform",function(b){return"translate("+a(b.base)+",0)"}).on("end",function(){var a=j.g.selectAll("text");a.transition().duration(500).attr("opacity",1)}),h.append("rect").attr("x",0).attr("y",0).attr("width",0).attr("height",this.settings.stackHeight).attr("opacity",0).attr("fill",function(a){return j.color(a.key)}).transition(l).attr("opacity",1).attr("width",function(a){return b(a)}),h.append("text").attr("dx",0).attr("dy",function(a,b){return 0==b%2?j.settings.textPositionOdd:j.settings.textPositionEven}).attr("text-anchor","end").attr("opacity",0).text(r).transition(l).attr("dx",function(b){return a(b.value)}),d.exit().transition(l).attr("opacity",0).attr("transform",function(b){return"translate("+a(b.base)+",0)"}).remove(),this.settings.disableEvents||("ontouchstart"in c.documentElement?this.g.selectAll(".stack").on("touchstart",m).on("touchend",function(a,b,c){o(a,b,c),p(a,b,c)}):this.g.selectAll(".stack").on("mouseover",m).on("mouseout",function(a,b,c){o(a,b,c)}).on("click",p))},onSectionClick:function(a){"function"==typeof this.settings.onSectionClick&&this.settings.onSectionClick(a)},hoverText:function(a){if("function"==typeof this.settings.hoverText)return this.settings.hoverText(a)}}),a.fn.stackbars=function(b){if("string"==typeof arguments[0]){var c,e=arguments[0],f=Array.prototype.slice.call(arguments,1);return this.each(function(){if(a.data(this,"plugin_stackbars")&&"function"==typeof a.data(this,"plugin_stackbars")[e])c=a.data(this,"plugin_stackbars")[e].apply(this,f);else if("destroy"===e)a.data(this,"plugin_stackbars",null);else throw new Error("Method "+e+" does not exist on jQuery.stackbars")}),void 0===c?this:c}return"object"!=typeof b&&b?void 0:this.each(function(){a.data(this,"plugin_stackbars")||a.data(this,"plugin_stackbars",new d(this,b))})}})(jQuery,window,document,d3);